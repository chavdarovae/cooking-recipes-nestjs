name: Deploy Cooking Recipes RESTful Express Application to Render!

on:
    push:
        branches: ["main"]
    pull_request:
        branches: ["main"]
    workflow_dispatch:

jobs:
    deploy:
        runs-on: ubuntu-latest
        steps:
            - name: Checkout repository
              uses: actions/checkout@v4

            - name: Setup Node.js 23.1.0
              uses: actions/setup-node@v4
              with:
                  node-version: 23.1.0

            - name: Cache node modules
              uses: actions/cache@v3
              with:
                  path: ~/.npm
                  key: ${{ runner.os }}-node-${{ hashFiles('package-lock.json') }}
                  restore-keys: |
                      ${{ runner.os }}-node-

            - name: Install dependencies
              run: npm install --production

            - name: Build application
              run: npm run build --if-present

            - name: Deploy to Render
              uses: JorgeLNJunior/render-deploy@v1.4.5
              with:
                  service_id: ${{ secrets.SERVICE_ID }}
                  api_key: ${{ secrets.API_TOKEN }}
                  wait_deploy: true

            - name: Deployment complete
              run: echo "âœ… Deployment finished. Check Render dashboard for logs."
